# Network-Trojan-Detection

## Objective

Today I'm tasked with monitoring network alerts. The objective is to investigate and validate the network security alert indicating the detection of a network trojan and a potential corporate privacy violation. This involves analyzing the alert generated by an Intrusion Detection System (IDS) or Intrusion Prevention System (IPS) to understand the nature and context of the detected activity. The goal is to assess whether the alert indicates a legitimate security threat or if it is a benign event mistakenly flagged as malicious.

### Skills Learned

- Monitoring & Detection Skills.
- Proficiency in analyzing and interpreting network logs.
- Ability to generate and recognize attack signatures and patterns.
- Enhanced knowledge of network protocols and security vulnerabilities.
- Development of critical thinking and problem-solving skills in cybersecurity.

### Tools Used

- Brim.
- Network Miner.
- VirusTotal.

## Steps

### Task 1: Detecting the Network Trojan Alert and Identifying the Alert Signature

Procedure:

1. Open BRIM and navigate to the Queries tab on the left-hand side.
2. Double-click Suricata Alerts by Category and locate the alert titled A Network Trojan Was Detected.
3. Right-click and select New search with this value to refine the search.

Visual: All the alerts generated by Suricata.

![image](https://github.com/user-attachments/assets/aaa5bb8c-9154-44ea-8bf3-83f0aa6e3cfe)  

![image](https://github.com/user-attachments/assets/a6b9ee82-a790-4f00-9cb1-3ae3f28c1f19)  

Outcome: The search yielded several network trojan alerts. Upon reviewing the log details, I found the following information:

- Alert Signature: Detailed in the log entry.

- Source IP Address: 185[.]118[.]164[.]8 (defanged using CyberChef for safety).

- Destination IP Address: Available in the log details.

The Potential Corporate Privacy Violation alert also originated from the same IP address, indicating a potential link between the two incidents.

Visuals: Suricata alerts and log details for the trojan and privacy violation.

![image](https://github.com/user-attachments/assets/0c073caa-70fb-48e6-82cf-b45785ade3e8) 

The IP address that triggered both alerts is 185.118.164.8 (defanged as 185[.]118[.]164[.]8 for safety). I used CyberChef to defang the IP address.

### Task 2: Finding and Defanging the Full URI of the Malicious Downloaded File

Procedure:

1. In BRIM, revisit the Network Trojan alert and double-click for detailed log information.
2. From the detailed log, click on conn to view the related connections.
3. Inspect the HTTP request section to retrieve the host and URI.
   
Visuals: Log details of the related connections and HTTP request.

![image](https://github.com/user-attachments/assets/9058cff1-5756-4393-9a47-e614801f859e) 

Outcome: The full URI for the malicious file download was identified and defanged using CyberChef:

Full URI: awh93dhkylps5ulnq-be[.]com/czwih/fxla[.]php?l=gap1[.]cab

The User-Agent associated with this request was also logged.


### Task 3: Identifying the Payload within the CAB File

Procedure:

1. Open the PCAP file in NetworkMiner.
2. Navigate to the Files tab and filter for gap1.cab.
3. Double-click the file to view its details, including the MD5 hash.

Visuals: NetworkMiner, files tab.

![image](https://github.com/user-attachments/assets/8aba031d-2ff9-4e1d-ada1-655c710c9d43) 

Visuals: NetworkMiner displaying the MD5 hash.

![image](https://github.com/user-attachments/assets/7c3851f6-aa9e-4afc-9209-45846ee707db)  

Outcome: The MD5 hash of the gap1.cab file was extracted and used to search for more information on VirusTotal.

Using VirusTotal, the malicious file was identified as:

Payload Name: draw.dll

Visuals: VirusTotal analysis of the payload.

![image](https://github.com/user-attachments/assets/00fabd9d-cc1b-4af4-8941-a0c4568e9c1a) 

## Conclusion

This project successfully identified a network trojan and its associated activities, including the detection of potential corporate privacy violations. By utilizing BRIM, NetworkMiner, and VirusTotal, we were able to trace the malicious file back to its source and identify the payload, highlighting the importance of thorough network traffic analysis in cybersecurity defense.



